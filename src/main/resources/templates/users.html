<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Family House Points â€” Small App</title>
    <style>
        :root{
        --bg:#f7fbff; --card:#ffffff; --accent:#6c7ef8; --accent-2:#f86cb6; --muted:#9aa3c7; --success:#37c77f; --danger:#ff6b6b;
        font-family:Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
        }
        *{box-sizing:border-box}
        body{margin:0;background:linear-gradient(180deg,var(--bg),#f0f6ff);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px}
        .app{width:980px;max-width:98%;}
        header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
        .logo{width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:22px;box-shadow:0 6px 20px rgba(108,126,248,0.18)}
        h1{margin:0;font-size:20px}
        p.lead{margin:0;color:var(--muted);font-size:13px}


        .card{background:var(--card);border-radius:14px;padding:18px;box-shadow:0 6px 30px rgba(20,40,80,0.04);}
        table{width:100%;border-collapse:collapse}
        thead th{font-size:12px;text-align:left;color:var(--muted);padding:12px 10px}
        tbody td{padding:12px 10px;vertical-align:middle}
        .member{display:flex;align-items:center;gap:12px}
        .avatar{width:46px;height:46px;border-radius:10px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
        .btn{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--accent),#5b68f2);color:#fff;cursor:pointer;font-weight:600}
        .btn.small{padding:6px 8px;border-radius:8px;font-size:13px}
        .btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(108,126,248,0.12)}
        .controls{display:flex;gap:8px;align-items:center}
        .points{font-weight:800;font-size:18px}
        .subtle{color:var(--muted);font-size:13px}
        .plus,.minus{width:40px;height:40px;border-radius:10px;border:0;background:#fff;box-shadow:0 6px 18px rgba(20,40,80,0.06);cursor:pointer;font-weight:700}
        .plus:hover{transform:translateY(-2px)}


        .progress-wrap{background:#eef3ff;border-radius:999px;padding:6px;width:220px}
        .progress{height:8px;border-radius:999px;background:linear-gradient(90deg,var(--accent),var(--accent-2));width:0}


        .shop{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}
        .reward{background:linear-gradient(180deg,#fff,#fbfbff);border-radius:12px;padding:10px;width:150px;box-shadow:0 6px 18px rgba(20,40,80,0.03)}
        .reward h4{margin:6px 0 0 0;font-size:14px}
        .reward p{margin:4px 0 0;color:var(--muted);font-size:13px}
        .center{display:flex;align-items:center;justify-content:center}


        footer{margin-top:14px;display:flex;justify-content:space-between;align-items:center}
        .muted{color:var(--muted);font-size:13px}


        /* friendly micro-animations */
        .bounce{animation:bounce .36s ease}
        @keyframes bounce{0%{transform:translateY(0)}50%{transform:translateY(-6px)}100%{transform:translateY(0)}}


        /* responsive */
        @media (max-width:720px){
        .app{padding:8px}
        .controls{flex-wrap:wrap}
        .progress-wrap{width:160px}
        }


        /* confetti canvas sits on top */
        #confetti{position:fixed;left:0;top:0;pointer-events:none;width:100%;height:100vh;z-index:9999}
    </style>
</head>
<body>
<div class="app">
    <header>
        <div class="logo">HP</div>
        <div>
            <h1>Family House Points</h1>
            <p class="lead">Track points for <span th:text="${userNames}"></span> â€” add, spend and celebrate milestones ðŸŽ‰</p>
        </div>
    </header>


    <section class="card" id="mainCard">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <div class="subtle">Members & points</div>
            <div style="display:flex;gap:8px">
                <button class="btn ghost" id="resetBtn">Reset</button>
            </div>
        </div>


        <table>
            <thead>
            <tr>
                <th>Member</th>
                <th>Points</th>
                <th>Progress</th>
                <th style="text-align:right">Actions</th>
            </tr>
            </thead>
            <tbody id="membersTbody">
            <tr th:each="user : ${users}">
                <td th:text="${user.id}"></td>
                <td th:text="${user.name}"></td>
                <td th:text="${user.housePoints}"></td>
                <td><input type="number" name="pointNumbers" min="1" max="30"/><button class="btn" name="addCustomBtn">Add point</button></td>
            </tr>
            </tbody>
        </table>
        <div style="margin-top:12px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap">
            <div>
                <div class="muted">Rewards shop</div>
                <div class="shop" id="shop"></div>
            </div>
            <div style="min-width:180px;text-align:right">
                <div class="muted">Total family points</div>
                <div style="font-weight:800;font-size:18px" id="totalPoints">0</div>
            </div>
        </div>


        <footer>
            <div class="muted">Tip: click + to give points instantly or use "Add custom points" for specific values.</div>
            <div class="muted">Data stored in your browser (localStorage).</div>
        </footer>
    </section>
</div>
<script>


    function customAdd(id){
    const val = prompt('Enter points to add (use negative to subtract):','10');
    if(val===null) return;
    const n = parseInt(val,10);
    if(Number.isNaN(n)){alert('Please enter a number');return}
    adjustPoints(id,n);
    }


    function giveAll10(){
    state.members.forEach(m=>{m.points += 10});
    fireConfetti(); render();
    }


    // shop
    function renderShop(){
    shopWrap.innerHTML='';
    state.shop.forEach(item=>{
    const div = document.createElement('div'); div.className='reward';
    div.innerHTML = `<div style="display:flex;align-items:center;justify-content:space-between"><strong>${item.title}</strong><div style='font-weight:800'>${item.cost}</div></div><p>${item.desc}</p>`;
    const buy = document.createElement('button'); buy.className='btn small'; buy.style.marginTop='8px'; buy.textContent='Buy';
    buy.addEventListener('click',()=>openBuyModal(item));
    div.appendChild(buy);
    shopWrap.appendChild(div);
    })
    }


    function openBuyModal(item){
    const who = prompt(`Who is buying "${item.title}"? Enter member id (dad/mom/dima):`,'dima');
    if(who===null) return;
    const member = state.members.find(m=>m.id===who.toLowerCase());
    if(!member){alert('Member not found (use id).'); return}
    if(member.points < item.cost){alert(`${member.name} doesn't have enough points.`);return}
    if(!confirm(`${member.name} will spend ${item.cost} points for ${item.title}. Confirm?`)) return;
    member.points -= item.cost; render();
    setTimeout(()=>alert(`Enjoy the ${item.title}! ðŸŽ‰`),300);
    }


    // reset & custom add all
    document.getElementById('resetBtn').addEventListener('click',()=>{
    if(confirm('Reset all points to 0?')){
    state.members.forEach(m=>m.points=0); render();
    }
    });


    document.getElementsByName('addCustomBtn').forEach(b => b.addEventListener('click',()=>{
    const who = prompt('Enter member id to add points (dad/mom/dima) or "all" to give everyone:','dima');
    if(who===null) return;
    const val = prompt('Enter points to add (positive) or negative to subtract:','10'); if(val===null) return;
    const n = parseInt(val,10); if(Number.isNaN(n)){alert('Provide a number');return}
    if(who.toLowerCase()==='all'){state.members.forEach(m=>m.points=Math.max(0,m.points+n)); fireConfetti(); render(); return}
    const member = state.members.find(m=>m.id===who.toLowerCase()); if(!member){alert('member id not found');return}
    member.points = Math.max(0, member.points + n); if(n>0) fireConfetti(); render();
    }));


    // highlight leader
    function highlightLeader(){
    const max = Math.max(...state.members.map(m=>m.points));
    // subtle pulse for leader
    Array.from(document.querySelectorAll('tbody tr')).forEach((tr,i)=>{
    const member = state.members[i];
    if(member.points===max && max>0){ tr.style.boxShadow='0 10px 40px rgba(108,126,248,0.06)'; tr.style.borderRadius='12px'; }
    else { tr.style.boxShadow='none'; tr.style.borderRadius='0'; }
    });
    }


    // little bounce to show interaction
    function triggerBounce(id){
    const el = document.getElementById('points-'+id);
    if(!el) return; el.classList.remove('bounce'); void el.offsetWidth; el.classList.add('bounce');
    }


    // confetti (simple)
    const confCanvas = document.getElementById('confetti'); const confCtx = confCanvas.getContext('2d');
    function resizeConf(){confCanvas.width = window.innerWidth; confCanvas.height = window.innerHeight}
    window.addEventListener('resize',resizeConf); resizeConf();
    let confettiPieces = [];
    function fireConfetti(){
    const count = 80;
    for(let i=0;i<count;i++){
    confettiPieces.push({x:Math.random()*confCanvas.width,y:-20,vy:2+Math.random()*4,tx:Math.random()*confCanvas.width,rot:Math.random()*360, size:6+Math.random()*8,color:['#6c7ef8','#f86cb6','#37c77f','#ffd166'][Math.floor(Math.random()*4)],life:200+Math.random()*120});
    }
    if(!confettiTimer) confettiTimer = requestAnimationFrame(confettiLoop);
    }
    let confettiTimer = null;
    function confettiLoop(){
    confCtx.clearRect(0,0,confCanvas.width,confCanvas.height);
    for(let i=confettiPieces.length-1;i>=0;i--){const p = confettiPieces[i]; p.y += p.vy; p.rot += 6*p.vy/3; p.life -= 3; confCtx.save(); confCtx.translate(p.x,p.y); confCtx.rotate(p.rot*Math.PI/180); confCtx.fillStyle = p.color; confCtx.fillRect(-p.size/2,-p.size/2,p.size,p.size); confCtx.restore(); if(p.life<=0 || p.y>confCanvas.height+40) confettiPieces.splice(i,1);}
    if(confettiPieces.length>0) confettiTimer = requestAnimationFrame(confettiLoop); else {cancelAnimationFrame(confettiTimer); confettiTimer=null}
    }


    // initial render
    render();


    // expose small helper to change members (dev mode)
    window.hp = {
    addMember(obj){ state.members.push({...obj,points:obj.points||0}); render(); },
    setPoints(id,pts){ const m=state.members.find(x=>x.id===id); if(m){m.points=pts; render()} },
    reset(){ state.members.forEach(m=>m.points=0); render() }
    }
</script>
</body>
</html>